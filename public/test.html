<!DOCTYPE html>
<html lang="en">
<body>
<h1>Express.js API</h1>
<p>This API uses the hosted backend provided by FusionAuth. It does not contain any authentication code, it only validates an existing access token stored as a cookie at <code>app.at</code>.</p>

<button id="call">Call API</button>

<button id="refresh">Refresh token</button>

<a href="http://localhost:9011/app/login/e9fdb985-9173-4e01-9d73-ac2d60d1dc8f?redirect_url=http://localhost:5173/&scope=offline_access+openid">Login</a>

<script>
    const refresh = async function () {
        await fetch('http://localhost:9011/app/refresh/e9fdb985-9173-4e01-9d73-ac2d60d1dc8f', {
            method: 'POST',
            credentials: 'include',
            mode: 'cors',
            headers: {
                'Content-Type': 'application/json'
            },
        });
    }
    
    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('call').addEventListener('click', async function () {
            const response = await fetch('/');

            if (response.status === 401) {
                await refresh();
            } else {
                alert(await response.text());
            }
        });

        document.getElementById('refresh').addEventListener('click', refresh);

    });
</script>
</body>
</html>